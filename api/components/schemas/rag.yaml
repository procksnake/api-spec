RagQueryRequest:
  type: object
  required:
    - query
    - sessionId
  properties:
    query:
      type: string
      minLength: 2
      maxLength: 2000
      description: User query
      example: "What is list comprehension in Python?"
    sessionId:
      type: string
      pattern: "^[a-zA-Z0-9_-]+$"
      minLength: 1
      maxLength: 100
      description: Session identifier
      example: "sess_123456789"
    options:
      type: object
      description: Optional settings
      properties:
        similarityThreshold:
          type: number
          minimum: 0.0
          maximum: 1.0
          default: 0.7
          description: Similar query threshold
        maxSimilarQueries:
          type: integer
          minimum: 0
          maximum: 10
          default: 3
          description: Maximum number of similar queries to include
        includeMetadata:
          type: boolean
          default: false
          description: Whether to include processing metadata
        searchMode:
          type: string
          enum: [hybrid, semantic, keyword]
          default: hybrid
          description: Search mode

RagQueryResponse:
  allOf:
    - $ref: "../schemas/common.yaml#/APIResponse"
    - type: object
      properties:
        data:
          $ref: "#/RagQueryData"

RagQueryData:
  type: object
  required:
    - queryId
    - sessionId
    - response
  properties:
    queryId:
      type: string
      description: Unique query identifier
      example: "query_abc123"
    sessionId:
      type: string
      description: Session identifier
      example: "sess_123456789"
    response:
      type: string
      description: LLM generated response
      example: "List comprehension is a concise way to create lists in Python..."
    sources:
      type: array
      description: Referenced documents
      items:
        $ref: "#/RagQuerySource"
    similarQueries:
      type: array
      description: Similar previous queries
      items:
        $ref: "#/RagSimilarQuery"
    metadata:
      $ref: "#/RagResponseMetadata"

RagQuerySource:
  type: object
  required:
    - sourceId
    - relevanceScore
  properties:
    sourceId:
      type: string
      description: Document identifier
    title:
      type: string
      description: Document title
    relevanceScore:
      type: number
      minimum: 0.0
      maximum: 1.0
      description: Relevance score
    excerpt:
      type: string
      description: Relevant document excerpt
    url:
      type: string
      format: uri
      description: Original document URL

RagSimilarQuery:
  type: object
  required:
    - query
    - similarityScore
  properties:
    query:
      type: string
      description: Similar previous query
    similarityScore:
      type: number
      minimum: 0.0
      maximum: 1.0
      description: Similarity score
    queryId:
      type: string
      description: Previous query ID
    timestamp:
      type: string
      format: date-time
      description: Query timestamp

RagResponseMetadata:
  type: object
  description: Response processing metadata
  properties:
    processingTimeMs:
      type: integer
      description: Total processing time (milliseconds)
    vectorSearchTimeMs:
      type: integer
      description: Vector search time (milliseconds)
    llmResponseTimeMs:
      type: integer
      description: LLM response generation time (milliseconds)
    similarityCheckTimeMs:
      type: integer
      description: Similarity check time (milliseconds)
    sourcesCount:
      type: integer
      description: Number of referenced documents
    similarQueriesCount:
      type: integer
      description: Number of similar queries found

RagQueryHistory:
  type: object
  required:
    - queryId
    - query
    - timestamp
  properties:
    queryId:
      type: string
      description: Query identifier
    query:
      type: string
      description: Original query
    response:
      type: string
      description: Generated response
    timestamp:
      type: string
      format: date-time
      description: Query timestamp
    processingTimeMs:
      type: integer
      description: Processing time (milliseconds)

RagSessionCreateRequest:
  type: object
  required:
    - name
  properties:
    name:
      type: string
      minLength: 1
      maxLength: 100
      description: Session name
      example: "Python Learning Session"
    description:
      type: string
      maxLength: 500
      description: Session description
      example: "Session for learning Python programming concepts"
    tags:
      type: array
      items:
        type: string
      description: Session tags
      example: ["python", "programming", "learning"]

RagSessionCreateResponse:
  allOf:
    - $ref: "../schemas/common.yaml#/APIResponse"
    - type: object
      properties:
        data:
          $ref: "#/RagSession"

RagSessionListResponse:
  allOf:
    - $ref: "../schemas/common.yaml#/APIResponse"
    - type: object
      properties:
        data:
          $ref: "#/RagSessionListData"

RagSessionGetResponse:
  allOf:
    - $ref: "../schemas/common.yaml#/APIResponse"
    - type: object
      properties:
        data:
          $ref: "#/RagSessionData"

RagSessionBase:
  type: object
  required:
    - Id
    - createdAt
  properties:
    Id:
      type: integer
      format: uint64
      description: Session identifier
    name:
      type: string
      description: Session name
      example: "Python Learning Session"
    description:
      type: string
      description: Session description
      example: "Session for learning Python programming concepts"
    createdAt:
      type: string
      format: date-time
      description: Session creation timestamp
      example: "2025-05-24T10:30:00Z"
    updatedAt:
      type: string
      format: date-time
      description: Last update timestamp
      example: "2025-05-24T14:45:30Z"
    tags:
      type: array
      items:
        type: string
      description: Session tags
      example: ["python", "programming", "learning"]

RagSession:
  allOf:
    - $ref: "#/RagSessionBase"

RagSessionSummary:
  allOf:
    - $ref: "#/RagSessionBase"
    - type: object
      required:
        - totalQueries
      properties:
        totalQueries:
          type: integer
          description: Total number of queries in session
          example: 15
        lastQueryAt:
          type: string
          format: date-time
          description: Timestamp of last query
          example: "2025-05-24T14:45:30Z"

RagSessionData:
  allOf:
    - $ref: "#/RagSessionBase"
    - type: object
      required:
        - queries
        - pagination
        - totalQueries
      properties:
        totalQueries:
          type: integer
          description: Total number of queries in session
          example: 15
        queries:
          type: array
          items:
            $ref: "#/RagQueryHistory"
          description: List of queries in the session
        pagination:
          $ref: "../schemas/common.yaml#/Pagination"

RagSessionListData:
  type: object
  required:
    - sessions
    - pagination
  properties:
    sessions:
      type: array
      items:
        $ref: "#/RagSessionSummary"
      description: List of session summaries
    pagination:
      $ref: "../schemas/common.yaml#/Pagination"
      description: Pagination information
